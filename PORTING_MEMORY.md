# PORTING_MEMORY

**FIRST STEP EVERY SESSION: read this file first, then `PORTING.md`, then `PORTING_MANIFEST.md` before touching code.**

## Session Snapshot (2026-02-08)
- Scope scanned: `old-1.12.2` (425 Java files).
- Core registry flow located and mapped.
- Initial port planning and manifest docs created.
- Implemented 1.20.1 smoke-test block surface:
- Registered all 37 legacy blocks as placeholder blocks.
- Auto-registered matching block-items.
- Added creative tab listing all registered block-items.
- Generated blockstates/models/lang entries for all 37 blocks.
- Verified compile with `./gradlew compileJava`.
- Extended smoke-test surface to standalone items:
- Registered all 31 legacy standalone items as placeholder items.
- Generated item model JSONs for all standalone items.
- Updated creative tab listing to include block-items + standalone items.
- Verified resources with `./gradlew processResources`.
- Replaced placeholder visuals with legacy-asset smoke baseline:
- Copied legacy `textures/` and OBJ/MTL assets into current resources.
- Rewrote all 37 block model JSONs to Forge OBJ loader (`loader: forge:obj`) with `flip_v: true`.
- Replaced all 31 standalone item model JSONs to real legacy texture-backed models (no paper placeholders).
- Normalized legacy MTL texture references for 1.20 naming and case-sensitive paths.
- Verified no missing `bibliocraft:*` texture references from all copied MTL files.
- Verified resources/compile with `./gradlew processResources compileJava`.
- Restored first-pass 3D item models for legacy custom-rendered items:
- `atlas_book`, `compass`, `death_compass`, `maptool`, `painting_canvas` now point to OBJ models.
- Added `models/item/deathcompass.mtl` + `mtl_override` for death-compass texture mapping.
- Re-validated build after model changes with `./gradlew processResources compileJava`.
- Block-model correction pass for early visual parity:
- Added non-occluding placeholder block properties (`noOcclusion`, non-suffocating, non-view-blocking, non-redstone-conductor) in `ModBlocks.woodProps()`.
- Added explicit `"textures": {"particle": ...}` to all 37 block OBJ model JSON files, using first MTL `map_Kd` texture as particle source.
- Translated negatively-authored OBJ meshes to reduce whole-model offset:
- `+1 x` and `+1 z`: `cookiejar.obj`, `dinnerplate.obj`, `discrack.obj`, `lamp.obj`, `lantern.obj`, `markerpole.obj`, `paneler.obj`, `potionshelf.obj`, `seat.obj`, `swordpedestal.obj`, `table.obj`, `typewriter.obj`.
- `+1 z`: `sign.obj`, `label.obj`.
- Added major static visibility maps to emulate 1.12 default OBJ part selection and prevent overlapping variant geometry.
- Updated visibility on:
- `lamp_gold`, `lamp_iron`, `case`, `clock`, `table`, `seat`, `typewriter`, `furniture_paneler`, `fancy_sign`, `framed_chest`, `painting_press`, `printing_press`, `desk`, `typesetting_table`, `fancy_workbench`, `cookie_jar`, `bookcase`, `bookcase_creative`, `map_frame`, and all 5 `painting_frame_*` models.
- Added iron-specific material overrides:
- `models/block/lamp_iron.mtl` used by `lamp_iron.json`.
- `models/block/lantern_iron.mtl` used by `lantern_iron.json`.
- Added first-pass 1.20 voxel shape system:
- New `src/main/java/art/arcane/bibliocraft/block/StaticShapeBlock.java`.
- `src/main/java/art/arcane/bibliocraft/registry/ModBlocks.java` now assigns explicit non-full shapes to most display blocks instead of plain full-cube `Block`.
- Shape values are based on old 1.12 `getBoundingBox` plus current OBJ extents when needed.
- Build validation after shape pass: `./gradlew --no-daemon compileJava` succeeded.
- Added item-model 3D parity pass:
- Replaced all block item JSONs (`models/item/<block_id>.json`) from `parent: bibliocraft:block/...` to direct `forge:obj` model definitions matching each block OBJ config.
- Added explicit shared `display` transforms and `automatic_culling=false` across OBJ-backed item models to improve in-hand and GUI behavior.
- Converted `seatback1..seatback5` to 3D OBJ item models using `models/block/seat.obj` with per-item visibility part sets.
- Build validation after item pass: `./gradlew --no-daemon processResources compileJava` succeeded.
- Added registry skeleton breadth pass beyond blocks/items:
- Added `ModBlockEntities`, `ModMenus`, `ModEntities`, `ModEnchantments`, and `ModSounds`.
- Added placeholder runtime classes: `PlaceholderBlockEntity`, `PlaceholderMenu`, `SeatEntity`, `PlaceholderEnchantment`.
- Registered 34 legacy block entity IDs (including shared `bibliolight`), menu placeholders for legacy GUI surfaces, seat entity placeholder, two enchantments, and legacy sound keys.
- Updated `BiblioCraft` bootstrap to register all new deferred registers.
- Build validation after registry pass: `./gradlew --no-daemon compileJava` succeeded.
- Added BE-backed placeholder block wiring:
- Added `src/main/java/art/arcane/bibliocraft/block/PlaceholderEntityBlock.java` (`EntityBlock` + runtime BE type lookup by id).
- Updated all block registrations in `src/main/java/art/arcane/bibliocraft/registry/ModBlocks.java` to use `PlaceholderEntityBlock`.
- Preserved shared BE id mapping:
- `bookcase` is used by `bookcase` and `bookcase_creative`.
- `bibliolight` is used by `lamp_gold`, `lamp_iron`, `lantern_gold`, `lantern_iron`.
- Kept `desk`, `fancy_workbench`, and `printing_press` as full-shape placeholders while BE-backed.
- Build validation after BE wiring: `./gradlew --no-daemon compileJava` succeeded.
- Added horizontal-facing block/state parity baseline:
- Added `src/main/java/art/arcane/bibliocraft/block/HorizontalFacingEntityBlock.java` (horizontal `facing` property, rotate/mirror placement logic, rotated shape/collision caches).
- Updated `ModBlocks` helper constructors to use `HorizontalFacingEntityBlock` for all current placeholder block registrations.
- Rewrote all Bibliocraft blockstate JSONs to `facing=north/east/south/west` variants with `y` rotations.
- Build validation after facing/state pass: `./gradlew --no-daemon processResources compileJava` succeeded.
- Added item-visibility parity pass for OBJ block-items:
- Updated item models that have separate `*_item` mesh groups in source OBJ to render legacy-equivalent item parts.
- Updated files:
- `src/main/resources/assets/bibliocraft/models/item/case.json`
- `src/main/resources/assets/bibliocraft/models/item/framed_chest.json`
- `src/main/resources/assets/bibliocraft/models/item/painting_press.json`
- `src/main/resources/assets/bibliocraft/models/item/printing_press.json`
- Build validation after item-visibility pass: `./gradlew --no-daemon processResources compileJava` succeeded.
- Added network + recipe registry skeleton:
- Added `src/main/java/art/arcane/bibliocraft/network/ModNetwork.java` with placeholder `SimpleChannel` packet registrations matching legacy counts:
- 23 serverbound packet placeholders.
- 10 clientbound packet placeholders.
- Added recipe placeholder surfaces:
- `src/main/java/art/arcane/bibliocraft/registry/ModRecipes.java`
- `src/main/java/art/arcane/bibliocraft/recipe/EnchantedAtlasRecipe.java`
- Registered `RecipeSerializer` + `RecipeType` for `enchantedatlas`.
- Updated mod bootstrap to register network + recipe surfaces.
- Build validation after network/recipe pass: `./gradlew --no-daemon compileJava` succeeded.
- Added mounted-light parity baseline:
- Added `src/main/java/art/arcane/bibliocraft/block/MountedFacingEntityBlock.java`.
- `lamp_gold`, `lamp_iron`, `lantern_gold`, and `lantern_iron` now use `face + facing` state (`floor/wall/ceiling`).
- Added wall/ceiling model JSON variants for all four lamp/lantern blocks.
- Build validation after mounted-light pass: `./gradlew --no-daemon processResources compileJava` succeeded.
- Added mounted-state expansion for additional blocks:
- Added `src/main/java/art/arcane/bibliocraft/block/FloorWallFacingEntityBlock.java` (legacy floor/wall placement parity).
- `case` now uses floor/wall mount state + per-face/per-facing blockstate variants.
- `fancy_sign` now uses mounted state; block models split by mount face:
- wall uses sign/front only
- floor uses sign/front + `feetBottom`
- ceiling uses sign/front + `feetTop`
- `map_frame` now uses mounted state with floor/wall/ceiling shape baseline.
- Updated `MountedFacingEntityBlock` internals so floor and ceiling shapes also rotate by `facing`.
- Build validation after mount-state expansion: `./gradlew --no-daemon processResources compileJava` succeeded.
- Added event-hook + seat behavior breadth pass:
- Added common Forge event hooks in `src/main/java/art/arcane/bibliocraft/event/CommonGameplayEvents.java`:
- death (`LivingDeathEvent`) placeholder state capture.
- spawn/join (`EntityJoinLevelEvent`) placeholder replay hook.
- item toss (`ItemTossEvent`) packet-heavy item container-close placeholder.
- seat interaction (`PlayerInteractEvent.RightClickBlock`) mount behavior for `seat` block.
- Added client Forge render hook placeholders in `src/main/java/art/arcane/bibliocraft/event/ClientRenderEvents.java`:
- GUI overlay placeholder (`RenderGuiOverlayEvent.Post`).
- block highlight placeholder (`RenderHighlightEvent.Block`).
- Upgraded `src/main/java/art/arcane/bibliocraft/entity/SeatEntity.java`:
- stores/persists seat block position.
- repositions to seat center every tick.
- discards when target block is no longer a seat.
- auto-despawns shortly after losing rider.
- Build validation after event/seat pass: `./gradlew --no-daemon compileJava` succeeded.
- Added menu-open interaction breadth pass:
- Updated `src/main/java/art/arcane/bibliocraft/menu/PlaceholderMenu.java` to use a non-null registered `MenuType`.
- Updated `src/main/java/art/arcane/bibliocraft/registry/ModMenus.java`:
- menu registration now creates typed `PlaceholderMenu` instances using holder-backed `MenuType`.
- added block-id -> menu mapping surface (`getMenuForBlock`).
- Updated `src/main/java/art/arcane/bibliocraft/block/PlaceholderEntityBlock.java`:
- added `use(...)` override that opens mapped placeholder menus server-side (`NetworkHooks.openScreen`).
- returns `PASS` for unmapped blocks, so non-menu blocks keep default behavior.
- Build validation after menu-open pass: `./gradlew --no-daemon compileJava` succeeded.

## Critical Facts To Remember
- Legacy main mod entry: `old-1.12.2/src/main/java/jds/bibliocraft/BiblioCraft.java`.
- Main 1.12 registration split:
- Blocks + block-items: `BlockLoader`
- Standalone items + custom recipes: `ItemLoader`
- Block entities: `CommonProxy.initTileEntities()`
- Enchantments + event subscriber hooks: `BiblioCraft.RegisterTheThings`
- Network packets: `BiblioNetworking.setup()`
- GUI handler: `GuiLoader`
- Entity registration: `EntitySeat` via `EntityRegistry.registerModEntity(...)`
- Old OBJ models were always loaded with `flip-v=true` in 1.12 custom model classes.
- For 1.20.1 static model JSONs, use:
- `{"loader":"forge:obj","model":"bibliocraft:models/block/<file>.obj","flip_v":true}`
- User workflow constraint:
- Do not run `runClient` automatically; ask user when a visual smoke test is needed.
- Shape/source reminder:
- First-pass shape constants now live in `ModBlocks` (`SHAPE_*` fields) and should be kept in sync with `PORTING_MANIFEST.md` shape notes.
- Rotation/state reminder:
- Blockstates are no longer single empty variants; they now depend on `facing`. Any new block class without a `facing` property must not reuse the current generic blockstate template.
- Mounted-state reminder:
- Mount-style blocks now use either:
- `MountedFacingEntityBlock` (`face=floor|wall|ceiling`, all faces rotated by facing),
- or `FloorWallFacingEntityBlock` (`face=floor|wall`, no ceiling placement).
- Their blockstate JSON must include `face` + `facing` keys, not `facing` alone.
- Event-hook reminder:
- Legacy FORGE event surface now has placeholders in `event/CommonGameplayEvents` and `event/ClientRenderEvents`; extend these classes instead of scattering ad-hoc subscribers.
- Seat-behavior reminder:
- Seat mounting baseline currently lives in `CommonGameplayEvents.onSeatInteract` + `SeatEntity`; when seat tile behavior is ported, migrate/add occupancy checks there rather than removing this hook outright.
- Menu-open reminder:
- Placeholder menu open paths currently route through `PlaceholderEntityBlock#use` + `ModMenus.getMenuForBlock`.
- Add/remove mappings in one place (`ModMenus`) to keep interactive-surface coverage coherent.
- Item-model reminder:
- Block items now source 3D geometry directly from OBJ in their item model JSONs; avoid reverting to parent-linked block item JSONs unless a specific regression requires it.
- OBJ item-part reminder:
- Some OBJ files include both block and item meshes (`*_item`). For item models, prefer item groups (`*_item`) over block/open groups when both exist.

## Registry Surface Size (Legacy)
- Registered blocks: 37
- Registered standalone items: 31
- Registered block-item classes: 26 + 9 direct `ItemBlock` wrappers
- Registered block entities: 33 explicit + shared `BiblioLightTileEntity` (total 34 classes in use)
- Enchantments: 2
- Mod entity types: 1 (`EntitySeat`)
- Packets: 23 serverbound + 10 clientbound
- Recipes JSON files: 344
- Sounds JSON keys: 17
- Fluids: none found

## Registry Surface Size (Current 1.20.1 Placeholder Implementation)
- Placeholder blocks registered: 37
- Placeholder block-items registered: 37
- Placeholder standalone items registered: 31
- Total registered placeholder items currently visible in creative tab: 68
- Placeholder blocks are now BE-backed through `PlaceholderEntityBlock` (all 37 block IDs mapped to BE ids).
- Placeholder packet registrations (network channel): 33 total (23 serverbound + 10 clientbound).
- Placeholder recipe registrations: 1 serializer + 1 recipe type (`enchantedatlas`).
- Baseline visual asset pass completed:
- 37 block models now OBJ-backed (legacy meshes + textures)
- 68 item models now mapped (37 block-item parents + 31 standalone texture-backed models)

## Important Architecture Notes
- Many blocks inherit custom base classes (`BiblioBlock`, `BiblioWoodBlock`, `BiblioColorBlock`, `BiblioLightBlock`) and depend on:
- Block metadata (wood/color variants)
- Tile entity orientation/lock state
- NBT-driven custom texture key `renderTexture`
- Extended blockstate + OBJ model pipeline in `jds.bibliocraft.models`
- Legacy rendering stack heavily uses:
- `OBJLoader`
- custom state mappers
- TESR bindings (`ClientRegistry.bindTileEntitySpecialRenderer`)
- These patterns do not port directly to 1.20.1 and need replacement strategy.

## Gotchas / Risk Items
- Legacy registry names are mixed case (`Bookcase`, `LampGold`, etc.); preserve IDs intentionally or define migration aliases strategy.
- No sound `RegistryEvent.Register<SoundEvent>` flow found; legacy often instantiates `new SoundEvent(...)` directly.
- `RegisterCustomFramedBlocks` recipe registration is mostly commented out; used primarily for framed-content item generation/display in add-ons.
- BiblioWoods modules (`bop`, `forestry`, `natura`, `botania`) are separate `@Mod` classes in old source, but mostly integration logic, not new core block classes.
- Legacy leftovers exist and are not registered (`ItemCompendium`, utility block-item classes, abstract `BlockPainting` base).
- Many legacy models were dynamic (wood/color/parts/needle/lighting) via custom baked model code; current pass is static smoke baseline only.
- Several item models were `builtin/generated` in 1.12 and relied on custom item override renderers; current pass uses static texture-backed item models.
- Legacy block render alignment relied on 1.12 `ExtendedBlockState` + `OBJModel.OBJState` transforms (angle/shift/vertical variants); static 1.20 OBJ JSONs can still appear offset until those transforms are ported.

## Immediate Next Steps (When Continuing)
- Continue minimal block class upgrades beyond placeholder BE hookup (state properties, interaction hooks, and menu open paths).
- Keep iterating visual parity: triage remaining misaligned models by block id and adjust OBJ translation/visibility/shape constants.
- Next interaction target: add item-held menu open parity for atlas/slotted-book style flows, then convert selected high-traffic blocks from generic placeholder menu to block-specific placeholder menus with slot scaffolding.
- Ask user for focused visual smoke feedback batches (5-10 blocks/items at a time) and fix in priority order.
- Keep mapping parity against `PORTING_MANIFEST.md` as ground truth.

## Workspace Reminder
- Active 1.20.1 registry code now in:
- `src/main/java/art/arcane/bibliocraft/BiblioCraft.java`
- `src/main/java/art/arcane/bibliocraft/registry/ModBlocks.java`
- `src/main/java/art/arcane/bibliocraft/registry/ModItems.java`
- Active smoke-test assets now in:
- `src/main/resources/assets/bibliocraft/blockstates`
- `src/main/resources/assets/bibliocraft/models/block`
- `src/main/resources/assets/bibliocraft/models/item`
- `src/main/resources/assets/bibliocraft/lang/en_us.json`
- Use old source under `old-1.12.2` for reference only; do not edit old files unless intentionally annotating migration notes.
